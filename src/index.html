<!doctype html>
<html>
<head>
    <title>YouTube Inbox</title>

    <link rel="stylesheet" href="libraries/font-awesome-4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="index.css">

    <script src="libraries/gapi/auth.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>
    <script src="libraries/linkify/linkify.min.js"></script>
    <script src="libraries/linkify/linkify-string.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <link rel="icon" href="favicon-vflz7uhzw.ico" sizes="32x32">
</head>
<body>
<div id="container"></div>

<script id="template" type="text/html">
    <div class="top-bar">
        <label class="btn btn-default settings-toggle" title="Settings">
            <i class="fa fa-gear"></i>
            <input class="hidden" type="checkbox" checked="{{showSettings}}">
        </label>
        <button class="btn btn-default" title="Refresh" on-click="refresh"><i class="fa fa-refresh"></i></button>
        {{#each videoLists:list}}
        <label class="tab" id="{{name}}">
            <input type="radio" name="{{selectedList}}" value="{{list}}" class="hidden">
            <div class="text {{#if selectedList === list}}selected{{/if}}">{{capitalise(name)}} ({{listLength(this)}})
            </div>
        </label>
        {{/each}}

        {{#if selectedList === 0}}
        <button class="btn btn-default mark-all" title="Mark all as watched" on-click="markAll:{{true}}">
            <i class="fa fa-check"></i></button>
        {{elseif selectedList === 1}}
        <button class="btn btn-default mark-all" title="Mark all as unwatched" on-click="markAll:{{false}}">
            <i class="fa fa-remove"></i>
        </button>
        {{/if}}
    </div>
    <div class="videos">
        {{#each videoLists:list}}
        <div class="{{name}}-videos video-list {{#if selectedList !== list}}hidden{{/if}}">
            {{#each (reversed ? videos.slice().reverse() : videos)}}
            {{#if filter(this)}}
            <Video/>
            {{/if}}
            {{/each}}
        </div>
        {{/each}}
        <div class="no-videos">
            End of videos.
        </div>
    </div>

    <div class="settings {{#if !showSettings}}hidden{{/if}}">
        {{#if !apiLoaded}}
        <button class="btn btn-default" on-click="login">Log in</button>
        {{/if}}
        <label>Update interval:<input type="number" value="{{update}}"/>minutes.
            <div class="note">(0 for never)</div>
        </label>
        <label>Discard watched videos older than<input type="number" value="{{history}}"/>days old.</label>

        <p class="note">(Unwatched videos will be kept forever)</p>
        <div class="checkbox">
            <label><input type="checkbox" checked="{{autoplay}}">Auto-play videos?</label>
        </div>
        <div class="checkbox">
            <label><input type="checkbox" checked="{{expand}}">Expand playing videos?</label>
        </div>

        <div class="filter-panel">
            <h4>Filters:</h4>
            {{#if filter}}
            <div class="header">
                <div class="author">Channel Name:</div>
                <div class="type"></div>
                <div class="regex">Filter:</div>
            </div>
            {{/if}}
            <div class="rows">
                {{#each filter:index}}
                <div class="row">
                    <input class="author" type="text" value="{{channel}}">
                    <select class="type form-control" value="{{type}}">
                        <option value="blacklist">Blacklist</option>
                        <option value="whitelist">Whitelist</option>
                    </select>
                    <input class="regex" type="text" value="{{regexes}}">
                    <div on-click="filterRemove:{{index}}" title="Remove this row">
                        <i class="fa fa-remove"></i>
                    </div>
                </div>
                {{/each}}
            </div>
            <button class="btn btn-default" on-click="filterAdd" title="Add new filter">Add</button>
        </div>

        <div class="additional-channels-panel">
            <h4>Additional YouTube Channels:</h4>
            {{#if additionalChannels}}
            <div class="header">
                <div class="name">Name:</div>
            </div>
            {{/if}}
            <div class="rows">
                {{#each additionalChannels:index}}
                <div class="row">
                    <a class="name" href="https://www.youtube.com/channel/{{id}}" target="_blank">{{name}}</a>
                    <div on-click="channelRemove:{{index}}" title="Remove this channel">
                        <i class="fa fa-remove"></i>
                    </div>
                </div>
                {{/each}}
            </div>
            <form class="add-channel" on-submit="channelAdd">
                <input type="text" class="name-input" placeholder="Channel URL" value="{{newChannel}}">
                <input type="submit" class="btn btn-default" value="Add Channel">
            </form>
        </div>
    </div>
</script>

<script id="video-component" type="text/html">
    <div class="video-container {{#if expanded}}expanded{{/if}}">
        <div class="video" on-click="play:{{id}}" on-resize="resize">
            <div class="thumbnail" style="background-image: url({{thumbnail}})">
                <p>{{title}}</p>
                <i class="fa fa-play fa-3x"></i>
            </div>
        </div>
        <div class="video-info">
            <div class="author">
                <a href="http://www.youtube.com/channel/{{authorId}}" target="_blank">{{author}}</a>
            </div>
            <div class="upload-date">uploaded {{formatDate(publishedDate)}}</div>

            <div class="description {{#if truncated}}truncated{{/if}}">
                {{#each paragraphs(description)}}
                <p>{{{this}}}</p>
                {{/each}}
            </div>

            <label>
                <input type="checkbox" checked="{{truncated}}" class="hidden">
                <span>{{#if truncated}}Read more{{else}}Read less{{/if}}</span>
            </label>
        </div>
        <div class="side-buttons">
            {{#if !blocked(this)}}
            {{#if !watched}}
            <button class="btn btn-default" title="Mark as watched" on-click="mark:{{id}}">
                <i class="fa fa-check fa-3x"></i></button>
            {{else}}
            <button class="btn btn-default" title="Mark as unwatched" on-click="mark:{{id}}">
                <i class="fa fa-remove fa-3x"></i></button>
            {{/if}}
            {{/if}}
            <a class="youtube-watch btn btn-default" title="Watch on YouTube"
               href="https://www.youtube.com/watch?v={{id}}" target="_blank">
                <i class="fa fa-youtube fa-3x"></i>
            </a>
            <label>
                <input type="checkbox" checked="{{expanded}}" on-change="expandedChange" class="hidden">
                {{#if expanded}}
                <div class="btn btn-default" title="Compress Video">
                    <i class="fa fa-compress fa-3x"></i>
                </div>
                {{else}}
                <div class="btn btn-default" title="Expand Video">
                    <i class="fa fa-expand fa-3x"></i></div>
                {{/if}}
            </label>
        </div>
    </div>
</script>

<script src='http://cdn.ractivejs.org/latest/ractive.min.js'></script>
<script src="index.js"></script>
</body>
</html>