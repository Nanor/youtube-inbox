<!doctype html>
<html>
<head>
    <title>YouTube Inbox</title>

    <link rel="stylesheet" href="libraries/font-awesome-4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="index.css">

    <script src="libraries/gapi/auth.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>
    <script src="libraries/linkify/linkify.min.js"></script>
    <script src="libraries/linkify/linkify-string.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <link rel="icon" href="favicon-vflz7uhzw.ico" sizes="32x32">
</head>
<body>
<div id="container"></div>

<script id="template" type="text/html">
    <div class="top-bar">
        <label for="settings-toggle" class="btn btn-default settings-toggle"><i class="fa fa-gear"></i></label>
        <button class="btn btn-default" on-click="refresh"><i class="fa fa-refresh"></i></button>

        {{#each videoLists}}
        <label class="tab" id="{{name}}">
            <input type="radio" name="tab" checked="{{display}}">
            <div class="text">{{capitalise(name)}} ({{videos.length}})</div>
        </label>
        {{/each}}

        {{#if videoLists[0].display}}
        <button class="btn btn-default mark-all" title="Mark all as watched" on-click="allDone">
            <i class="fa fa-check"></i></button>
        {{elseif videoLists[1].display}}
        <button class="btn btn-default mark-all" title="Mark all as unwatched" on-click="allUndone">
            <i class="fa fa-remove"></i>
        </button>
        {{/if}}
    </div>
    <div class="videos">
        {{#each videoLists}}
        <div class="{{name}}-videos video-list" style="display: {{#if display}}block{{else}}none{{/if}};">
            {{#each videos}}
            <div class="video-container {{#if expanded}}expanded{{/if}}">
                <Video/>
            </div>
            {{/each}}
        </div>
        {{/each}}
        <div class="no-videos">
            End of videos.
        </div>
        <input id="settings-toggle" type="checkbox">

        <div class="settings">
            <label for="settings-toggle" class="btn btn-default settings-toggle"><i class="fa fa-gear"></i></label>
            {{#if !apiLoaded}}
            <button class="btn btn-default" on-click="login">Log in</button>
            {{/if}}
            <label>Update interval:<input type="number" value="{{updateInput}}"/>minutes.
                <div class="note">(0 for never)</div>
            </label>
            <label>Discard watched videos older than<input type="number" value="{{historyInput}}"/>days old.</label>

            <p class="note">(Unwatched videos will be kept forever)</p>
            <div class="checkbox">
                <label><input type="checkbox" checked="{{autoplayInput}}">Auto-play videos?</label>
            </div>
            <div class="checkbox">
                <label><input type="checkbox" checked="{{expandInput}}">Expand playing videos?</label>
            </div>

            <h4>Filters:</h4>

            {{#with filter}}
            <div class="filter-panel">
                <div class="header">
                    <div class="author">Channel Name:</div>
                    <div class="type"></div>
                    <div class="regex">Filter:</div>
                </div>
                <div class="rows">
                    {{#each contents:index}}
                    <div class="row">
                        <input class="author" type="text" value="{{channel}}">
                        <select class="type form-control" value="{{type}}">
                            <option value="blacklist">Blacklist</option>
                            <option value="whitelist">Whitelist</option>
                        </select>
                        <input class="regex" type="text" value="{{regexes}}">
                        <button class="btn btn-default" on-click="filterRemove:{{index}}">Remove</button>
                    </div>
                    {{/each}}
                </div>
                <button class="btn btn-default" on-click="filterAdd">Add</button>
            </div>
            {{/with}}
        </div>
    </div>
</script>

<script id="video-component" type="text/html">
    <div class="video" on-click="play:{{id}}">
        <div class="thumbnail" style="background-image: url({{thumbnail}})">
            <p>{{title}}</p>
            <i class="fa fa-play fa-3x"></i>
        </div>
    </div>
    <div class="video-info">
        <div class="author">
            <a href="http://www.youtube.com/channel/{{authorId}}" target="_blank">{{author}}</a>
        </div>
        <div class="upload-date">uploaded {{publishedDate.toLocaleString()}}</div>

        <div class="description {{#if truncated}}truncated{{/if}}">
            {{#each paragraphs(description)}}
            <p>{{{this}}}</p>
            {{/each}}
        </div>

        <label>
            <input type="checkbox" checked="{{truncated}}">
            {{#if truncated}}
            <span class="read-more">Read more</span>
            {{else}}
            <span class="read-less">Read less</span>
            {{/if}}
        </label>
    </div>
    <div class="side-buttons">
        {{#if name === 'unwatched'}}
        <button class="btn btn-default" title="Mark as watched" on-click="done:{{id}}">
            <i class="fa fa-check fa-3x"></i></button>
        {{elseif name == 'watched'}}
        <button class="btn btn-default" title="Mark as unwatched" on-click="undone:{{id}}">
            <i class="fa fa-remove fa-3x"></i></button>
        {{/if}}
        <a class="youtube-watch btn btn-default" title="Watch on YouTube"
           href="https://www.youtube.com/watch?v={{id}}" target="_blank">
            <i class="fa fa-youtube fa-3x"></i>
        </a>
        <label>
            <input type="checkbox" checked="{{expanded}}" on-change="expandedChange">
            {{#if expanded}}
            <div class="btn btn-default" title="Compress Video">
                <i class="fa fa-compress fa-3x"></i>
            </div>
            {{else}}
            <div class="btn btn-default" title="Expand Video">
                <i class="fa fa-expand fa-3x"></i></div>
            {{/if}}
        </label>
    </div>
</script>

<script src='http://cdn.ractivejs.org/latest/ractive.min.js'></script>
<script src="index.js"></script>
</body>
</html>